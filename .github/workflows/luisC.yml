name: continuous-integration-<nombre_alumno>

on:
    push:
        branches:
        - master

jobs:
    first-job:
        name: Create file with secrets
        runs-on: ubuntu-latest
    
        env:
            USERNAME: ${{ secrets.USER }}
            PASSWORD: ${{ secrets.PASSWORD }}

        steps:
            - name: verify branch
              uses: actions/checkout@v2
            - name: envsubst-action
              uses: nowactions/envsubst@v1
              with:
                input: ./credentials.ini.tpl
                output: ./credentials.ini

            - name: Pruebas de SAST
              run: echo "EjecuciÃ³n de pruebas de SAST"
            
            - name: Crear archivo de credenciales
              run: |
               envsubst "s/\${USERNAME}/$USERNAME/g; s/\${PASSWORD}/$PASSWORD/g" credentials.ini.tpl > /tmp/credentials.ini
            
            - name: Build docker image
              run: |
                docker build -t devops_ws . --tag devops_ws_$(date +%s)