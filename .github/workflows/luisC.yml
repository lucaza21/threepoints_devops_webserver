name: continuous-integration-<Luis-Carrasquilla>

on:
    push:
        branches:
        - master
        - 'feature*'
        - 'hotfix*'
    pull_request:
        branches:
        - master
        - 'feature*'
        - 'hotfix*'

jobs:
    first-job:
        name: Create file with secrets
        runs-on: ubuntu-latest
    
        env:
            USERNAME: ${{ secrets.USER }}
            PASSWORD: ${{ secrets.PASSWORD }}

        steps:
            - name: verify branch
              uses: actions/checkout@efature/nueva
            - name: envsubst-action
              uses: nowactions/envsubst@v1
              with:
                input: ./credentials.ini.tpl
                output: ./credentials.ini
            
            - name: Condici칩n de rama
              run: |
                if [[ ! $GITHUB_REF =~ ^(refs/heads/(master|feature.*|hotfix.*))$ ]]; then
                    echo "Este flujo de trabajo no est치 configurado para ejecutarse en la rama actual."
                    exit 1
                fi
            - name: Pruebas de SAST
              run: echo "Ejecuci칩n de pruebas de SAST"
            
            - name: Crear archivo de credenciales
              run: |
               export USERNAME=${USERNAME}
               export PASSWORD=${PASSWORD}
               envsubst < credentials.ini.tpl > /tmp/credentials.ini

            - name: A침adir cambios al repositorio
              run: |
                 git config --global user.email "luis.carrasquilla.z@gmail.com"
                 git config --global user.name "lucaza21"
                 git add credentials.ini
                 git commit -m "Add credentials.ini"

            - name: Push cambios al repositorio
              uses: ad-m/github-push-action@efature/nueva
              with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
            
            - name: Build docker image
              run: |
                docker build -t devops_ws . --tag devops_ws_$(date +%s)